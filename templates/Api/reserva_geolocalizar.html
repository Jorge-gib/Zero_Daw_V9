{% extends 'base.html' %}
{% load static %}

{% block content %}
<div id="containerHome" class="hidden fade-in-down">
    <h1 class="letras4">Ordenes de reserva para buscar ubicacion del ciudadano!</h1>
    <p class="letras4">Seleccione la orden para buscar la ubicacion del ciudadano</p>

    {% if ordenes %}
        {% with hay_ordenes_concluidas=False %}
            <ul>
                {% for orden in ordenes %}
                    {% if orden.estado != "Concluido" and orden.estado != "Calificado" %}
                        {% with hay_ordenes_concluidas=True %}
                            <li>
                                <p class="letras4">ID de orden: {{ orden.id_orden }}</p>
                                <p class="letras4">Fecha de orden: {{ orden.fecha_orden }}</p>
                                <p class="letras4">hora inicio: {{ orden.hora_inicio }}</p>
                                <p class="letras4">hora fin: {{ orden.hora_fin }}</p>
                                <p class="letras4">Cantidad plastico: {{ orden.cantidad_plastico }}</p>
                                <p class="letras4">Cantidad vidrio: {{ orden.cantidad_vidrio }}</p>
                                <p class="letras4">Cantidad carton: {{ orden.cantidad_carton }}</p>
                                <p class="letras4">Cantidad aluminio: {{ orden.cantidad_aluminio }}</p>
                                <p class="letras4">Estado: {{ orden.estado }}</p>

                                <!-- Enviar el ID de la orden al hacer clic en el botón -->
                                <form method="POST" action="{% url 'geolocalizacion_reserva_ciudadano' orden.id_orden %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="orden_id" value="{{ orden.id_orden }}">
                                    <button type="submit">Seleccionar</button>
                                </form>
                            </li>
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            </ul>
            {% if not hay_ordenes_disponibles %}
                <p class="letras4">No hay más órdenes disponibles</p>
            {% endif %}
        {% endwith %}
    {% else %}
        <p class="letras4">No hay más registros de órdenes</p>
    {% endif %}

    <a href="{% url 'login' %}">Volver</a>
</div>

<!-- Mapa de Leaflet -->
<div id="map" style="height: 400px; width: 100%;"></div>

<script>
    var latitud = {{ latitud }};
    var longitud = {{ longitud }};
    var map = L.map('map').setView([latitud, longitud], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap'
    }).addTo(map);

    L.marker([latitud, longitud]).addTo(map)
        .bindPopup('Ubicación del ciudadano')
        .openPopup();
</script>

{% endblock %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/fondo.css' %}">
<link rel="stylesheet" href="{% static 'css/animations.css' %}">
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
{% endblock %}

{% block javascript %}
<script src="{% static 'js/animations.js' %}"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
{% endblock %}
