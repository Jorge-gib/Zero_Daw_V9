{% extends 'base.html' %}
{% load static %}
{% block title %}Pagina de inicio{% endblock title %}

{% block content %}
<<<<<<< HEAD
<script>
  function verificarCampos() {
      var fecha = document.getElementById("fecha_orden").value;
      var horaInicio = document.getElementById("hora_inicio").value;
      var horaFin = document.getElementById("hora_fin").value;
      var cantidad_plastico = document.getElementById("cantidad_plastico").value;
      var cantidad_vidrio = document.getElementById("cantidad_vidrio").value;
      var cantidad_carton = document.getElementById("cantidad_carton").value;
      var cantidad_aluminio = document.getElementById("cantidad_aluminio").value;
      var latitud = document.getElementById("latitud_posicion_ciudadano").value;
      var longitud = document.getElementById("longitud_posicion_ciudadano").value;

      if (fecha === "" || horaInicio === "" || horaFin === "" || cantidad_plastico === "" || cantidad_vidrio === "" || cantidad_carton === "" || cantidad_aluminio === "" || latitud === "" || longitud === "") {
          alert("Por favor, complete todos los campos para registrar la orden, en la cantidad de materiales si no reciclara nada coloque 0");
          return false;
      }
      document.getElementById("estado").value = "En espera";
      return true;
  }
</script>
<div class="titulo_presentacion fade-in-down">
  <div class="blue-background">
    <h1 class="letras">Llene la lista para realizar la orden de reserva</h1>
    <div>
      <p class="letras">Recuerde que para validar su reserva, un recolector debe confirmarla.</p>
    </div>

    <form method="POST" action="{% url 'orden_reserva' %}" onsubmit="return verificarCampos()">
      {% csrf_token %}

      <!-- Campo oculto para el ID del usuario -->
      <input type="hidden" name="id_user" value="{{ user.id }}">

      <!-- Campos de entrada para los campos de Orden_reciclaje -->
      <div>
          <label class="letras" for="fecha_orden">Fecha de orden:</label>
          <input type="date" name="fecha_orden" id="fecha_orden">
      </div>
      <div>
          <label class="letras" for="hora_inicio">Hora de inicio:</label>
          <input type="time" id="hora_inicio" name="hora_inicio">
      </div>
      <div>
          <label class="letras" for="hora_fin">Hora de fin:</label>
          <input type="time" id="hora_fin" name="hora_fin">
      </div>
     
      <div>
        <label class="letras" for="cantidad_plastico">Cantidad de plastico:</label>
        <input type="number" name="cantidad_plastico" id="cantidad_plastico" placeholder="Ingrese cantidad">
      </div>
      <div>
        <label class="letras" for="cantidad_vidrio">Cantidad de vidrio:</label>
        <input type="number" name="cantidad_vidrio" id="cantidad_vidrio" placeholder="Ingrese cantidad">
      </div>
      <div>
        <label class="letras" for="cantidad_carton">Cantidad de carton:</label>
        <input type="number" name="cantidad_carton" id="cantidad_carton" placeholder="Ingrese cantidad">
      </div>
      <div>
        <label class="letras" for="cantidad_aluminio">Cantidad de aluminio:</label>
        <input type="number" name="cantidad_aluminio" id="cantidad_aluminio" placeholder="Ingrese cantidad">
      </div>
      <div>
        <label class="letras" for="cantidad_metal">Cantidad de metal:</label>
        <input type="number" name="cantidad_metal" id="cantidad_metal" placeholder="Ingrese cantidad">
      </div>
      <div>
        <label class="letras" for="cantidad_electrodomesticos">Cantidad de electro domesticos:</label>
        <input type="number" name="cantidad_electrodomesticos" id="cantidad_electrodomesticos" placeholder="Ingrese cantidad">
      </div>

      <div>
          <label class="letras" for="latitud_posicion_ciudadano">Latitud:</label>
          <input type="number" name="latitud_posicion_ciudadano" id="latitud_posicion_ciudadano" step="0.000001" placeholder="Latitud">
      </div>
      <div>
          <label class="letras" for="longitud_posicion_ciudadano">Longitud:</label>
          <input type="number" name="longitud_posicion_ciudadano" id="longitud_posicion_ciudadano" step="0.000001" placeholder="Longitud">
      </div>
      <input type="hidden" name="estado" value="En espera">

      <button type="submit">Guardar</button>
      <button type="reset">Limpiar campos</button>
      <button type="button" onclick="capturarUbicacion()">Capturar Ubicación</button>
    </form>

    <div id="success-message" style="display: none;">El objeto Orden_reciclaje se registró con éxito.</div>

    <script>
=======
<br>
<div class="letras hidden fade-in-down">
    <h1>Agendar una orden de retiro</h1>
    <p>Complete el formulario para reservar un retiro a domicilio</p>
    <p>Recuerde que debe esperar a que un recolector acepte su orden</p>
</div>
<br>
<div class="form-map-container">
    <form id="container" class="hidden fade-in-down" method="POST" action="{% url 'orden_reserva' %}" onsubmit="return verificarCampos()">
        {% csrf_token %}
        <!-- Campo oculto para el ID del usuario -->
        <input type="hidden" name="id_user" value="{{ user.id }}">

        <!-- Campos de entrada para los campos de Orden_reciclaje -->
        <div class="form-group">
            <label class="letras" for="fecha_orden">Fecha de orden:</label>
            <input type="date" name="fecha_orden" id="fecha_orden" class="form-control">
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="letras" for="hora_inicio">Hora de inicio:</label>
                <input type="time" id="hora_inicio" name="hora_inicio" class="form-control">
            </div>
            <div class="form-group col-md-6">
                <label class="letras" for="hora_fin">Hora de fin:</label>
                <input type="time" id="hora_fin" name="hora_fin" class="form-control">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="letras" for="cantidad_plastico">Cantidad de plastico:</label>
                <input type="number" name="cantidad_plastico" id="cantidad_plastico" class="form-control" placeholder="Ingrese cantidad">
            </div>
            <div class="form-group col-md-6">
                <label class="letras" for="cantidad_vidrio">Cantidad de vidrio:</label>
                <input type="number" name="cantidad_vidrio" id="cantidad_vidrio" class="form-control" placeholder="Ingrese cantidad">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="letras" for="cantidad_carton">Cantidad de carton:</label>
                <input type="number" name="cantidad_carton" id="cantidad_carton" class="form-control" placeholder="Ingrese cantidad">
            </div>
            <div class="form-group col-md-6">
                <label class="letras" for="cantidad_aluminio">Cantidad de aluminio:</label>
                <input type="number" name="cantidad_aluminio" id="cantidad_aluminio" class="form-control" placeholder="Ingrese cantidad">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label class="letras" for="latitud_posicion_ciudadano">Latitud:</label>
                <input type="text" name="latitud_posicion_ciudadano" id="latitud_posicion_ciudadano" class="form-control" placeholder="Latitud" readonly>
            </div>
            <div class="form-group col-md-6">
                <label class="letras" for="longitud_posicion_ciudadano">Longitud:</label>
                <input type="text" name="longitud_posicion_ciudadano" id="longitud_posicion_ciudadano" class="form-control" placeholder="Longitud" readonly>
            </div>
        </div>

        <input type="hidden" name="estado" value="En espera">

        <div class="button-group">
            <button type="submit" class="btn btn-primary">Guardar</button>
            <button type="reset" class="btn btn-secondary">Limpiar campos</button>
            <button type="button" class="btn btn-info" onclick="capturarUbicacion()">Capturar Ubicación</button>
        </div>

        <div class="mt-3">
            <a class="btn btn-link" href="{% url 'reserva_list' %}">Ver orden reciclaje</a>
            <a class="btn btn-link" href="{% url 'login' %}">Volver</a>
        </div>
    </form>

    <div id="map-container" class="map-container hidden">
        <div id="map" style="height: 400px; width: 100%; background-color: #f0f0f0;"></div>
    </div>
</div>

<div id="success-message" style="display: none;">El objeto Orden_reciclaje se registró con éxito.</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      let map;

>>>>>>> main
      function showSuccessMessage() {
          document.getElementById("success-message").style.display = "block";
      }

      function capturarUbicacion() {
          if (navigator.geolocation) {
<<<<<<< HEAD
              navigator.geolocation.getCurrentPosition(function (position) {
=======
              navigator.geolocation.getCurrentPosition(function(position) {
                  console.log("Geolocalización obtenida");
>>>>>>> main
                  var latitud = position.coords.latitude.toFixed(6);
                  var longitud = position.coords.longitude.toFixed(6);

                  document.getElementById("latitud_posicion_ciudadano").value = latitud;
                  document.getElementById("longitud_posicion_ciudadano").value = longitud;
<<<<<<< HEAD
=======

                  var mapContainer = document.getElementById("map-container");
                  mapContainer.classList.remove("hidden");
                  mapContainer.classList.add("fade-in");
                  console.log("Contenedor del mapa visible");

                  if (!map) {
                      map = L.map('map').setView([latitud, longitud], 15);
                      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                          maxZoom: 19,
                          attribution: '© OpenStreetMap'
                      }).addTo(map);
                      console.log("Mapa inicializado");
                  } else {
                      map.setView([latitud, longitud], 15);
                      console.log("Vista del mapa actualizada");
                  }

                  var marker = L.marker([latitud, longitud]).addTo(map)
                      .bindPopup('Tu ubicación')
                      .openPopup();
                  console.log("Marcador añadido al mapa");
>>>>>>> main
              });
          } else {
              alert("Tu navegador no admite la geolocalización.");
          }
      }
<<<<<<< HEAD
    </script>
    <div>
      <a class="link" href="{% url 'reserva_list' %}">Ver orden reciclaje</a>
    </div>
    <div>
      <a class="link" href="{% url 'home' %}">Volver</a>
    </div>
  </div>
</div>

{% block javascript %}
<script src="{% static 'js/animations.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
      const elements = document.querySelectorAll('.fade-in-down');

      elements.forEach(element => {
          element.classList.remove('hidden');

          element.addEventListener('animationend', () => {
              element.classList.remove('fade-in-down');
          });
      });
  });
</script>
{{ block.super }}
{% endblock %}
=======

      // Expose the function globally
      window.capturarUbicacion = capturarUbicacion;

      // Set the default date
      const fechaOrdenInput = document.getElementById('fecha_orden');
      const fechaActual = new Date().toISOString().split('T')[0];
      fechaOrdenInput.value = fechaActual;
  });
</script>
<script>
    function verificarCampos() {
        var fecha = document.getElementById("fecha_orden").value;
        var horaInicio = document.getElementById("hora_inicio").value;
        var horaFin = document.getElementById("hora_fin").value;
        var cantidad_plastico = document.getElementById("cantidad_plastico").value;
        var cantidad_vidrio = document.getElementById("cantidad_vidrio").value;
        var cantidad_carton = document.getElementById("cantidad_carton").value;
        var cantidad_aluminio = document.getElementById("cantidad_aluminio").value;
        var latitud = document.getElementById("latitud_posicion_ciudadano").value;
        var longitud = document.getElementById("longitud_posicion_ciudadano").value;

        if (fecha === "" || horaInicio === "" || horaFin === "" || cantidad_plastico === "" || cantidad_vidrio === "" || cantidad_carton === "" || cantidad_aluminio === "" || latitud === "" || longitud === "") {
            alert("Por favor, complete todos los campos para registrar la orden, en la cantidad de materiales si no reciclara nada coloque 0");
            return false;
        }

        document.getElementById("estado").value = "En espera";

        return true;
    }
</script>

<!-- Añade la biblioteca de Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
>>>>>>> main

{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/animations.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    {{ block.super }}
{% endblock stylesheets %}

{% block javascript %}
    <script src="{% static 'js/animations.js' %}"></script>
    {{ block.super }}
{% endblock %}
